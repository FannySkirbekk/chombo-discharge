<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PlasmaC: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSsymbols.js", "TeX/AMSmath.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="html_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PlasmaC
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="doxy-contents.html"><span>Contents</span></a></li>
      <li><a href="gallery.html"><span>Gallery</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Building the documentation </h1>
<p>Before proceeding further, please install doxygen and build the code documentation. This requires that doxygen is installed on your computer, but it does not require a working installation of the code. To build the documentation, please type </p><pre class="fragment">doxygen doxyfile 
</pre><p>in your shell (from the main folder). This will compile the documentation of the code in which you will find installation instructions. After building the documentation, please proceed ../chombo-streamer/doc/doxygen/html/index.html and navigate to installation instructions.</p>
<h1>Installation instructions </h1>
<h2>Prerequisites </h2>
<p>The numerical code is written in C++ using the <a href="https://commons.lbl.gov/display/chombo/Chombo+-+Software+for+Adaptive+Solutions+of+Partial+Differential+Equations">MFChombo</a> library and can be compiled on UNIX systems (both workstations and clusters). Compilation requires the following prerequisites to be in place:</p>
<ol type="1">
<li>A C++ compiler (e.g. g++, icpc)</li>
<li>A Fortran compiler (e.g. gfortran, ifort)</li>
<li>An MPI compiler (e.g. OpenMPI)</li>
<li>A working HDF5 installations, both parallel and serial.</li>
</ol>
<p>Compilers can be installed straightforwardly on UNIX systems; for users of Ubuntu-like systems we recommend that you install g++ (and gcc), gfortran, and OpenMPI.</p>
<h2>HDF5 installation </h2>
<p>Before attempting to install HDF5, please make sure that C++, Fortran, and MPI compilers are in place.</p>
<p>HDF5 (Hierarchical Data Format) is a portable, binary data file with parallel support and is used to reduce I/O bottlenecks in simulations. HDF5 can be obtained from <a href="https://support.hdfgroup.org/HDF5/">here</a>.</p>
<p>While it is possible to compile our code for serial execution only, we generally recommend that the user installs both serial and parallel versions of HDF5. The two versions should <em>not</em> be installed in the same directory. For versions of HDF5 newer than 1.6, we require that the user configures HDF5 with the 1.6 API version.</p>
<ol type="1">
<li>Compile and install zlib (a compression library). zlib can be obtained through <pre class="fragment"> sudo apt-get install zlib1g-dev
</pre></li>
<li><p class="startli">Download and install HDF5 for <em>serial execution</em>. </p><pre class="fragment"> ./configure --prefix=/usr/local/hdf5 --enable-production --enable-cxx --enable-fortran --with-default-api-version=v16
 make
 make install
</pre><p class="startli">This will install a serial version of HDF5 in /usr/local/hdf5 (if you want to install</p>
</li>
<li><p class="startli">Install HDF5 for <em>parallel execution</em> </p><pre class="fragment"> ./configure --prefix=/usr/local/phdf5 --enable-production --enable-fortran --with-default-api-version=v16 --enable-parallel
 make
 make install
</pre><p class="startli">This will install a parallel version of HDF5 in /usr/local/phdf5</p>
</li>
</ol>
<h2>Building the source code </h2>
<p>Once sequential and parallel versions of HDF5 are installed, the source code may be built. The source is built by inheriting a set of makefiles from Chombo. By default, a version of Chombo-3.2 is shipped with this code. To build the source code, you must ensure that the makefile finds the Chombo library by modifying the GNUmakefile which lies at the top directory in the code. Modify this file so that <code>CHOMBO_HOME</code> points to the correct location (a full path specification may be necessary). For example, if the code is in the home folder of a user <code>exampleUser</code>, <code>CHOMBO_HOME</code> should be </p><pre class="fragment">CHOMBO_HOME := /home/exampleUser/FluidAMRStreamer/Chombo-3.2/lib
</pre><p>Specification of default settings for Chombo are necessary for compiling both the Chombo library and the source code. You should modify Make.defs.local which lies in Chombo-3.2/lib/mk/ for specification of compilers and path to the serial and parallel HDF5 installations. If you installed HDF5 in /usr/local/hdf5 and /usr/local/phdf5, the default settings in Make.defs.local are (probably) sufficient.</p>
<p>The streamer code can be compiled for two-dimensional and three-dimensional executation on Cartesian grids (default is 2D). To compile the code, it should be sufficient to navigate to one of the plasma models and then execute </p><pre class="fragment">make "model"
</pre><p>where "model" is replaced by the model name. If you want to silence GNUmake during the compilation stage, include a flag -s. I.e. </p><pre class="fragment">make -s "model"
</pre><p>This will inherit a set of makefiles: Chombo source codes are compiled first and the streamer code is compiled second. To execute for three-dimensional execution, either make appropriate changes to Make.defs.local (DIM=3), or run </p><pre class="fragment">make DIM=3 "model"
</pre><p>By default, the executable will be named according to the specifications in Make.defs.local. For example, if the code was compiled for optimized three-dimensional execution using MPI (mpiCC as compiler) gfortran on a Linux system, the executable is named </p><pre class="fragment">plasma3d.Linux.64.mpiCC.gfortran.OPT.MPI.ex
</pre><p>The code has compiled successfully if this file is created.</p>
<h1>Compilation on vilje </h1>
<p>To compile the system on the <em>vilje</em> supercomputer, you need to load compilers and libraries before compiling the code. We recommend that you use intel compilers by loading </p><pre class="fragment">module load intelcomp/15.0.1
</pre><p>which will load Intel compilers for Fortran and C/C++ (version 15.0.1). MPI libraries are loaded by </p><pre class="fragment">module load mpt/2.10
</pre><p>and HDF5 is loaded by </p><pre class="fragment">module load hdf5/1.8.14
</pre><p>It is likely possible to load newer versions of compilers, MPI, and HDF5 (but we haven't tried). Once the libraries are loaded, the code may be compiled as usual. It will be necessary to update CHOMBO_HOME and supply the library path to the Chombo makefiles. CHOMBO_HOME is simply updated to the folder in which Chombo is installed. HDF5 paths are found by typing </p><pre class="fragment">module disp hdf5/1.8.14
</pre><p>which will display the library paths to HDF5. The typical output is </p><pre class="fragment">/sw/sdev/modulefiles/hdf5/1.8.14:

module-whatis    general purpose library and file format for storing scientific data 
prereq   intelcomp/15.0.1 
prereq   mpt/2.10 
prepend-path     PATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/bin 
prepend-path     CPATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/include 
prepend-path     FPATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/include 
prepend-path     LIBRARY_PATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/lib 
prepend-path     LD_LIBRARY_PATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/lib 
prepend-path     PYTHONPATH /sw/sdev/Modules/hdf5/hdf5-1.8.14/lib/python2.7/site-packages 
setenv           HDF5_DIR /sw/sdev/Modules/hdf5/hdf5-1.8.14 

Loads HDF5 version 1.8.14
</pre><p>To use Intel's Fortran and C/C++ compilers, please specify </p><pre class="fragment"> FC  = ifort
 CXX = icpc
</pre><p>in Make.defs.local. Likewise, update Make.defs.local so that it finds the HDF5 libraries and include files. For this version of HDF5, they are located in </p><pre class="fragment"> /sw/sdev/Modules/hdf5/hdf5-1.8.14/include 
 /sw/sdev/Modules/hdf5/hdf5-1.8.14/lib 
</pre><p>With these paths, the appropriate flags in Make.defs.local are </p><pre class="fragment">HDFINCFLAGS    = -I/sw/sdev/Modules/hdf5/hdf5-1.8.14/include 
HDFLIBFLAGS    = -L/sw/sdev/Modules/hdf5/hdf5-1.8.14/lib -lhdf5 -lz 

HDFMPIINCFLAGS = -I/sw/sdev/Modules/hdf5/hdf5-1.8.14/include 
HDFMPILIBFLAGS = -L/sw/sdev/Modules/hdf5/hdf5-1.8.14/lib -lhdf5 -lz
</pre><h1>Compilation on fram </h1>
<p>To compile the system on the <em>fram</em> supercomputer, you need to load compilers and libraries before compiling the code. The intel compiler toochain is loaded by </p><pre class="fragment">module load intel/2017a
</pre><p>which will load Intel compilers for Fortran and C/C++, as well as Intel MPI. The code may be compiled as usual. It will be necessary to update CHOMBO_HOME and supply the library path to the Chombo makefiles. CHOMBO_HOME is simply updated to the folder in which Chombo is installed. HDF5 paths are found by typing </p><pre class="fragment">module disp HDF5/1.10.1-intel-2017a
</pre><p>which will display the library paths to HDF5.</p>
<p>To use Intel's Fortran and C/C++ compilers, please specify </p><pre class="fragment"> MPICXX = mpiicpc
 FC     = ifort
 CXX    = icpc
</pre><p>in Make.defs.local. Likewise, update Make.defs.local so that it finds the HDF5 libraries and include files.</p>
<p>We also recommend that you compile with -xCORE-AVX2 (put it in cxxoptflags and foptflags) to enable advanced vector extensions. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 26 2018 13:27:07 for PlasmaC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
