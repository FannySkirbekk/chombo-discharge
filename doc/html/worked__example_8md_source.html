<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PlasmaC: doc/worked_example.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSsymbols.js", "TeX/AMSmath.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="html_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PlasmaC
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="doxy-contents.html"><span>Contents</span></a></li>
      <li><a href="gallery.html"><span>Gallery</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">doc/worked_example.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="worked__example_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Worked example {#worked-example}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;================================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;chombo-streamer is built from a mini-app principle where the user builds his own application from existing modules, or implements his own modules. In this section we show how to build mini-apps using a simple python interface that autogenerates the missing implementation pieces.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;We will attempt to simulate a positive streamer discharge from a needle in a 2cm x 2cm domain; we do not consider the presence of dielectrics. As mentioned in @ref program-structure, applications primarily differ in the choice of plasma kinetic schemes and the geometries that are simulated. In this particular case we will use the Morrow-Lowke model for air discharges and a geometry that defines a needle slab geometry (although in this particular case we will eventually turn off the dielectric slab).</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;To create the mini-app, we do the following:</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      python build.py -dim=2 -chombo_home=$(CHOMBO_HOME) -streamer_home=$(STREAMER_HOME) -base_dir=test_apps -app_name=rod_sphere2d -plasma_kinetics=morrow_lowke -geometry=rod_sphere -time_stepper=rk2 -cell_tagger=field_tagger</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;The python script will then autogenerate the required C++ and makefiles that you need for compiling the application. Note that, in the above, $(CHOMBO_HOME) should be the full path to the Chombo library, and $(STREAMER_HOME) should be the full path to the chombo-streamer code. If, for example, the Chombo library resides in your home folder /home/my_username/mf-chombo, you must specify</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      -chombo_home=/home/my_username/mf-chombo</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;However, your may also use environmental variables like $(CHOMBO_HOME), if you have that specified. The remaining arguments specify where the mini-app will be stored. In this particular case, it will be placed under ./test_apps/rod2d where you will find your main.cpp file, your makefile, and a templated inputs file which contains an aggregation of all the input options that you can use to fine-tune your application (e.g. the number of AMR levels that you will use). Note that the templated file is almost never suitable for production runs; extensive modifications to this file is usually required in order to get an application up and running.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;First, we will build the executable for 2D execution. Navigate to $(STREAMER_HOME)/test_apps/rod2d and type</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      make -s -j 10 main</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;which will compile your executable. It will be named something like main.2d.Linux.64.mpicxx.gfortran.OPT.MPI.ex, depending on your Chombo configuration. If you have more cores available for computation, you may increase the process count (e.g. -j 10 uses 10 processes, or cores, for computation).</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;To run the example application, the typical usage is</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      mpirun -np 10 main.2d.Linux.64.mpicxx.gfortran.OPT.MPI.ex simulation.inputs</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;This will run your mini-app using 10 cores, using whatever is available in &#39;simulation.inputs&#39; as input parameters to your program. Our next step is to modify our template inputs file to something more coherent. For this application, you can just copy the contents below to an input script of your choice (for example simulation.inputs). </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      # POTENTIAL CURVE</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      rod_sphere2d.potential = 1.2E4</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      # PHYSICAL_DOMAIN CLASS OPTIONS</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      physical_domain.lo_corner = -2E-3 -2E-3    # Low corner of problem domain</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      physical_domain.hi_corner =  2E-3  2E-3    # High corner of problem domain</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      # ROD_SLAB CLASS OPTIONS</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      rod_sphere.eps0                      = 1.0                              # Background permittivity</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      rod_sphere.turn_off_electrode        = false                            # Turn on/off electrode</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      rod_sphere.turn_off_dielectric       = true                             # Turn on/off dielectric</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      rod_sphere.electrode_live            = true                             # Live electrode or not</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      rod_sphere.electrode_radius          = 200.E-6                          # Electrode radius</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      rod_sphere.electrode_center1         = 0.0 0.0 0E-2                     # Center 1</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      rod_sphere.electrode_center2         = 0.0 1.0 0E-2                     # Center 2</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      rod_sphere.dielectric_permittivity   = 5.0                              # Dielectric permittivity</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      rod_sphere.dielectric_center         = 0.0 -500.E-6 0.0                 # Dielectric center</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      rod_sphere.dielectric_radius         = 200.E-6                         # Dielectric radius</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      # AMR_MESH OPTIONS</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      amr.verbosity       = -1          # Controls verbosity. </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      amr.coarsest_domain = 128 128     # Number of cells on coarsest domain</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      amr.max_amr_depth   = 4           # Maximum amr depth</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      amr.max_sim_depth   = 4           # Maximum simulation depth</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      amr.fill_ratio      = 1.0         # Fill ratio for grid generation</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      amr.irreg_growth    = 2           # How much to grow irregular tagged cells</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      amr.buffer_size     = 1           # Number of cells between grid levels</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      amr.blocking_factor = 8           # Default blocking factor (16 in 3D)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      amr.max_box_size    = 16          # Maximum allowed box size</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      amr.max_ebis_box    = 64          # Maximum allowed box size</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      amr.ref_rat         = 2 2 2 2 2   # Refinement ratios</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      amr.num_ghost       = 3           # Number of ghost cells. Default is 3</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      amr.eb_ghost        = 4           # Set number of of ghost cells for EB stuff</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      amr.redist_radius   = 1           # Redistribution radius for hyperbolic conservation laws</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      amr.stencil_order   = 1           # Order for interpolation/extrapolation stencils. Must be 1 or 2</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      amr.stencil_radius  = 1           # Radius for interpolation/extrapolation stencils. Must be 1 or 2</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      amr.stencil_type    = linear      # Default stencil type. Valid options are &#39;linear&#39;, &#39;taylor&#39;, &#39;lsq&#39;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      amr.ghost_interp    = pwl         # Ghost cell interpolation type. Valid options are &#39;pwl&#39; or &#39;quad&#39;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      amr.load_balance    = knapsack    # Load balancing algorithm. Valid options are &#39;knapsack&#39; or &#39;elliptic&#39;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      amr.ebcf            = false       # Tell amr to ignore EBCF-related code. </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      # PLASMA_ENGINE OPTIONS</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      plasma_engine.verbosity                       = 2             # Engine verbosity</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      plasma_engine.plot_interval                   = 10            # Plot interval</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      plasma_engine.regrid_interval                 = 10            # Regrid interval</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      plasma_engine.checkpoint_interval             = 10            # Checkpoint interval</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      plasma_engine.init_regrids                    = 0             # Number of initial regrids</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      plasma_engine.start_time                      = 0             # Start time (fresh simulations only)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      plasma_engine.stop_time                       = 1.0           # Stop time</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      plasma_engine.max_steps                       = 1000          # Maximum number of steps</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      plasma_engine.geometry_only                   = false         # Special option that ONLY plots the geometry</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      plasma_engine.ebis_memory_load_balance        = false         # Use memory as loads for EBIS generation</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      plasma_engine.write_ebis                      = false         # Write geometry to an HDF5 file (buggy, leave as false)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      plasma_engine.read_ebis                       = false         # Read EBIS when restarting a simulation</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      plasma_engine.output_mode                     = full          # Output mode</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      plasma_engine.output_directory                = ./            # Output directory</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      plasma_engine.output_names                    = simulation    # Simulation output names</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      plasma_engine.restart                         = false         # Do restart or not</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      plasma_engine.restart_step                    = 0             # Restart step</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      plasma_engine.restart_mode                    = full          # Restart mode. </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      plasma_engine.refine_geometry                 = -1            # Refine geometry, -1 =&gt; Refine all the way down</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      plasma_engine.refine_electrodes               = -1            # Refine electrode surfaces. -1 =&gt; equal to refine_geometry</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      plasma_engine.refine_dielectrics              = -1            # Refine dielectric surfaces. -1 =&gt; equal to refine_geometry</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      plasma_engine.refine_electrode_gas_interface  = -1            # Refine electrode-gas interfaces. -1 =&gt; ----&quot;-----</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      plasma_engine.refine_dielectric_gas_interface = -1            # Refine dielectric-gas interfaces. -1 =&gt; ----&quot;-----</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      plasma_engine.refine_solid_gas_interface      = -1            # Refine solid-gas interfaces. -1 =&gt; ----&quot;-----</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      plasma_engine.refine_solid_solid_interface    = -1            # Refine solid-solid interfaces. -1 =&gt; ----&quot;-----</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      # TIME_STEPPER OPTIONS</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      time_stepper.verbosity        = -1    # Class verbosity</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      time_stepper.solver_verbosity = -1    # Individual solver verbosities</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      time_stepper.fast_rte         = 5     # Solve RTE every this time steps</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      time_stepper.fast_poisson     = 1     # Solve Poisson every this time steps</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      time_stepper.min_dt           = 0.    # Minimum permitted time step</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      time_stepper.max_dt           = 1.E99 # Maximum permitted time step</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      time_stepper.cfl              = 0.1   # CFL number</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      time_stepper.relax_time       = 10.0  # Relaxation time constant</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      time_stepper.source_growth    = 1000.0 # Relaxation time constant</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      </div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      # POISSON_SOLVER CLASS OPTIONS</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      poisson_solver.bc_x_low  = neumann               # BC type. Valid options are &quot;neumann&quot;, &quot;dirichlet_ground&quot;, and &quot;dirichlet_live&quot;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      poisson_solver.bc_x_high = neumann               # BC type. Valid options are &quot;neumann&quot;, &quot;dirichlet_ground&quot;, and &quot;dirichlet_live&quot;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      poisson_solver.bc_y_low  = dirichlet_ground      # BC type. Valid options are &quot;neumann&quot;, &quot;dirichlet_ground&quot;, and &quot;dirichlet_live&quot;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      poisson_solver.bc_y_high = dirichlet_live        # BC type. Valid options are &quot;neumann&quot;, &quot;dirichlet_ground&quot;, and &quot;dirichlet_live&quot;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      # POISSON_MULTIFLUID_GMG CLASS OPTIONS (MULTIFLUID GMG SOLVER SETTINGS)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      poisson_multifluid.gmg_verbosity     = -10       # GMG verbosity</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      poisson_multifluid.gmg_pre_smooth    = 16         # Number of relaxations in downsweep</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      poisson_multifluid.gmg_post_smooth   = 16         # Number of relaxations in upsweep</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      poisson_multifluid.gmg_bott_smooth   = 16         # NUmber of relaxations before dropping to bottom solver</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      poisson_multifluid.gmg_min_iter      = 5         # Minimum number of iterations</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      poisson_multifluid.gmg_max_iter      = 32        # Maximum number of iterations</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      poisson_multifluid.gmg_tolerance     = 1.E-6     # Residue tolerance</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      poisson_multifluid.gmg_hang          = 0.2       # Solver hang</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      poisson_multifluid.gmg_bottom_drop   = 4         # Bottom drop</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      poisson_multifluid.gmg_bottom_solver = bicgstab  # Bottom solver type. Valid options are &#39;simple&#39; and &#39;bicgstab&#39;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      poisson_multifluid.gmg_bottom_relax  = 32        # Number of relaxations in bottom solve (&#39;simple&#39; solver only)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      # CDR_LAYOUT SOLVER SETTINGS</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      # ----------------------------------------------------------------------------------------------------</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      cdr_layout.which_solver = godunov                # Solver type, available options are &quot;scharfetter-gummel&quot; and &quot;godunov&quot;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      cdr_gdnv.divF_nc        = covered_face           # Valid options are &quot;covered_face&quot; and &quot;conservative_average&quot;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      cdr_gdnv.limit_slopes   = true                   # Valid options are &quot;covered_face&quot; and &quot;conservative_average&quot;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      # RTE_LAYOUT CLASS OPTIONS</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      rte_layout.which_solver = eddington_sp1 # Solver type. Available option is &quot;eddington_sp1&quot;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      rte_layout.stationary   = true          # Stationary solver ot no.</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      # EDDINGTON_SP1 CLASS OPTIONS</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      eddington_sp1.reflectivity      = 0.        # Reflectivity</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      eddington_sp1.gmg_verbosity     = -10       # GMG verbosity</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      eddington_sp1.gmg_pre_smooth    = 6         # Number of relaxations in downsweep</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      eddington_sp1.gmg_post_smooth   = 6         # Number of relaxations in upsweep</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      eddington_sp1.gmg_bott_smooth   = 6         # NUmber of relaxations before dropping to bottom solver</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      eddington_sp1.gmg_min_iter      = 5         # Minimum number of iterations</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      eddington_sp1.gmg_max_iter      = 32        # Maximum number of iterations</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      eddington_sp1.gmg_tolerance     = 1.E-6     # Residue tolerance</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      eddington_sp1.gmg_hang          = 0.2       # Solver hang</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      eddington_sp1.gmg_bottom_drop   = 4         # Bottom drop</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      eddington_sp1.gmg_bottom_solver = bicgstab  # Bottom solver type. Valid options are &#39;simple&#39; and &#39;bicgstab&#39;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      eddington_sp1.gmg_bottom_relax  = 32        # Number of relaxations in bottom solve (&#39;simple&#39; solver only)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      # RK2 CLASS OPTIONS</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      rk2.alpha = 0.5 # Set alpha. 0.5 = Heuns method, 1.0 = Midpoint method</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      # FIELD_TAGGER CLASS OPTIONS</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      field_tagger.coarsen_curvature = 0.1    # Sets eps_curv for coarsening</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      field_tagger.coarsen_magnitude = 0.1    # Sets eps_mag for coarsening </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      field_tagger.refine_curvature  = 0.2    # Sets eps_curv for refinement</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      field_tagger.refine_magnitude  = 0.75   # Sets eps_mag for refinement</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      # MORROW_LOWKE CLASS OPTIONS</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      # ====================================================================================================</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      morrow_lowke.gas_temperature               = 300                   # Gas temperature (K)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      morrow_lowke.gas_N2_frac                   = 0.8                   # Mixing fraction of nitrogen</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      morrow_lowke.gas_O2_frac                   = 0.2                   # Mixing fraction of oxygen</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      morrow_lowke.gas_pressure                  = 1.0                   # Gas pressure (atm)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      morrow_lowke.gas_quenching_pressure        = 0.03947               # Quenching pressure for photo-emission (atm)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      morrow_lowke.positive_species_mobility     = 2.E-4                 # Positive species mobility</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      morrow_lowke.negative_species_mobility     = 2.E-4                 # Negative species mobility</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      morrow_lowke.excitation_efficiency         = 0.6                   # Impact excitation efficiency</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      morrow_lowke.photoionization_efficiency    = 0.1                   # Photo-ionization efficiency</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      morrow_lowke.electrode_townsend2           = 1.E-6                 # Townsend coefficient on electrodes</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      morrow_lowke.electrode_quantum_efficiency  = 1.E-6                 # Quantum efficiency on electrodes</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      morrow_lowke.dielectric_townsend2          = 1.E-6                 # Townsend coefficient on dielectrics</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      morrow_lowke.dielectric_quantum_efficiency = 1.E-6                 # Quantum efficiency on dielectrics</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      morrow_lowke.dielectric_work_function      = 1.E-6                 # Dielectric work function (ev)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      morrow_lowke.uniform_density               = 1.E10                 # Initial background ionization</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      morrow_lowke.seed_density                  = 0.E16                 # Initial seed ionization</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      morrow_lowke.seed_radius                   = 1E-3                  # Initial seed radius</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      morrow_lowke.seed_position                 = 0. 0. 0.              # Initial seed position</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      morrow_lowke.noise_amplitude               = 0.0                   # Initial noise amplitude</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      morrow_lowke.noise_octaves                 = 1                     # Initial noise octaves</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      morrow_lowke.noise_persistence             = 0.5                   # Reduction factor between each noise octave</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      morrow_lowke.noise_frequency               = 1.0 1.0 1.0           # Spatial noise frequency</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      morrow_lowke.photon1_A_coeff               = 1.12E-4               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      morrow_lowke.photon1_lambda_coeff          = 4.15E-2               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      morrow_lowke.photon2_A_coeff               = 2.88E-2               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      morrow_lowke.photon2_lambda_coeff          = 1.09E-1               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      morrow_lowke.photon3_A_coeff               = 2.76E-1               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      morrow_lowke.photon3_lambda_coeff          = 6.69E-1               # Parameters from Bourdon et. al photoionization model</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;The first step to running new mini-apps is usually to inspect the geometry and initial mesh. There is a special option in plasma_engine that allows us to dump the geometry to an HDF5 file. Our first command is therefore</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      mpirun -np 10 main2d.Linux.64.mpicxx.gfortran.OPT.MPI.ex simulation.inputs plasma_engine.geometry_only=true</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;where the option plasma_engine.geometry_only overrides whatever this option is set to in the input script. When you run the application, it will write a file called simulation.geometry.2d.hdf5. Note that you can call your simulation whatever you want, and have the data dump to a folder of your choice. This is controlled through plasma_engine.output_names and plasma_engine.output_directory. Modify them as you see fit. In addition, you will get a number of pout.# files. These files are the output of every process through which you can monitor mesh size, resolution, time step size, elapsed time and so on. Let us investigate the geometry file. Open the file in VisIt and plot the Filled Boundary and Mesh. You should see something like this (exact plots vary with VisIt versions):</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;&lt;img src=&quot;./simulation_geometry.png&quot; alt=&quot;Initial geometry and mesh&quot; style=&quot;width: 1024px;&quot;/&gt;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;That is our initial mesh and geometry, which looks what we want. Next, we will perform some screening simulations of this geometry. The current input script uses a resolution of about 2 microns and a CFL number of 0.1. Before we look for grid convergence, we attempt to resolve the simulation using larger spatial and temporal steps, at least for a short time. </div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      mpirun -np 10 main2d.Linux.64.mpicxx.gfortran.OPT.MPI.ex simulation.inputs amr.max_sim_depth=3 time_stepper.cfl=0.8 time_stepper.max_dt = 0.5E-9</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;The option amr.max_sim_depth=3 restricts to a maximum number of 3 AMR levels; the other two species a CFL number of 0.8 and a maximum simulation time of 0.5ns. To make this simulation run even faster, it might even be justifiable to only solve the RTE equations at certain intervals. To try this, you may add an option time_stepper.fast_rte=5, which will solve the RTE equations every 5 time steps. Depending on your hardware, the execution time for each time can be anywhere from a few hundred milliseconds to many seconds.</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;When the program has finished running, it will have executed 86 time steps. You will find plotfiles and checkpoint files in your specified directory. In our input script, we&#39;ve specified that these should be written every 10 timesteps. This is controlled through plasma_engine.plot_interval and plasma_engine.checkpoint_interval. The first and final timesteps are always written, as long as plasma_engine.plot_interval &gt; 0. Note that there is also an option plasma_engine.regrid_interval which specifies how often one should regrid. After 86 time steps, we examine the plasma (electron density):</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;&lt;img src=&quot;./plasma_density_500ps.png&quot; alt=&quot;plasma density&quot; style=&quot;width: 1024px;&quot;/&gt;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;Here, we&#39;ve plotted the data on a logarithmic scale. Realizing that we might need better resolution when the streamer starts propagating, we will simulate the next 0.5ns by using a finer mesh with 2 micron resolution and a CFL number of 0.4. We will restart from where we left off, time step 86:</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      mpirun -np 10 main2d.Linux.64.mpicxx.gfortran.OPT.MPI.ex simulation.inputs plasma_engine.restart=true plasma_engine.restart_step=86</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;The options above will restart our simulation from time step 86. Note that you may change a bunch of other options as well, including the way the grids are handled. However, you may NOT change the AMR levels since this interferes with interpretatin of where the data lives in space. On other hand, you can restrict amr.max_sim_depth as you see fit.</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 26 2018 13:27:07 for PlasmaC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
