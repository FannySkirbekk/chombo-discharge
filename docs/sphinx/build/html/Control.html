

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Controlling PlasmaC &mdash; PlasmaC 19.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualization" href="Visualization.html" />
    <link rel="prev" title="Understanding particle data" href="ParticleData.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PlasmaC
          

          
          </a>

          
            
            
              <div class="version">
                19.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PlasmaC introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Model.html">The <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code> code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics.html">Chombo basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Using PlasmaC</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Realm.html">Realm</a></li>
<li class="toctree-l1"><a class="reference internal" href="MeshData.html">Understanding mesh data</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParticleData.html">Understanding particle data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Controlling <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-compiling-and-running">Basic compiling and running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-output">Controlling output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-processor-output">Controlling processor output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#restarting-simulations">Restarting simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Visualization.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">PlasmaC design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Driver.html">driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrMesh.html">amr_mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputationalGeometry.html">computational_geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeStepper.html">time_stepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="CellTagger.html">cell_tagger</a></li>
</ul>
<p class="caption"><span class="caption-text">Supported solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Solver.html">Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="CDR.html">Convection-Diffusion-Reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson.html">Poisson</a></li>
<li class="toctree-l1"><a class="reference internal" href="RTE.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sigma.html">Surface charge solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ito.html">Îto diffusion</a></li>
</ul>
<p class="caption"><span class="caption-text">Implemented models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="PoissonModel.html">Poisson model</a></li>
<li class="toctree-l1"><a class="reference internal" href="AdvectionDiffusionModel.html">Advection diffusion model</a></li>
<li class="toctree-l1"><a class="reference internal" href="BrownianWalkerModel.html">Brownian walker model</a></li>
<li class="toctree-l1"><a class="reference internal" href="MinimalPlasmaModel.html">Minimal plasma model</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html#setting-up-time-stepper">Setting up <code class="docutils literal notranslate"><span class="pre">time_stepper</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="References.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PlasmaC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Controlling <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Control.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="controlling-plasmac">
<span id="chap-control"></span><h1>Controlling <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code><a class="headerlink" href="#controlling-plasmac" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we show how to run a <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code> simulation and control its behavior through input scripts or command line options.</p>
<div class="section" id="basic-compiling-and-running">
<h2>Basic compiling and running<a class="headerlink" href="#basic-compiling-and-running" title="Permalink to this headline">¶</a></h2>
<p>To run simulations, the user must first compile his application. Once the application has been defined, the user may compile is by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -s -j <span class="m">32</span> <span class="nv">DIM</span><span class="o">=</span>N &lt;application_name&gt;
</pre></div>
</div>
<p>where <em>N</em> may be 2 or 3, and &lt;application_name&gt; is the name of the file that holds the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function. This will compile an executable whose name depends on your application name and compiler settings. Please refer to the Chombo manual for explanation of the executable name. You may, of course, rename your application.</p>
<p>Next, applications are run by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">32</span> &lt;application_executable&gt; &lt;input_file&gt;
</pre></div>
</div>
<p>where &lt;input_file&gt; is your input file. On clusters, this is a little bit different and usually requires passing the above command through a batch system. Note that if you define a parameter multiple times in the input file, the last definition is canon.</p>
<p>You may also pass input parameters through the command line. For example, running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">32</span> &lt;application_executable&gt; &lt;input_file&gt; driver.max_steps<span class="o">=</span><span class="m">10</span>
</pre></div>
</div>
<p>will set the <code class="docutils literal notranslate"><span class="pre">driver.max_steps</span></code> parameter to 10. Command-line parameters override definitions in the input_file.</p>
</div>
<div class="section" id="controlling-output">
<span id="chap-controllingoutput"></span><h2>Controlling output<a class="headerlink" href="#controlling-output" title="Permalink to this headline">¶</a></h2>
<p><cite>PlasmaC</cite> comes with controls for adjusting output. Through the <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">driver</span></a> class the user may adjust the option <code class="docutils literal notranslate"><span class="pre">driver.output_directory</span></code> to specify where output files will be placed. This directory is relative to the location where the application is run. If this directory does not exist, PlasmaC does it’s best at creating it. In addition, it will create four more directories</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">output_directory/plt</span></code> contains all plot files.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">output_directory/chk</span></code> contains all checkpoint files, which are used for restarting.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">output_directory/mpi</span></code> contains information about individual MPI ranks.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">output_directory/geo</span></code> contains geometric files that are written by PlasmaC (if you enable <code class="docutils literal notranslate"><span class="pre">driver.write_ebis</span></code>).</p></li>
</ul>
<p>The files in <code class="file docutils literal notranslate"><span class="pre">output_directory/geo</span></code> do <em>not</em> represent your geometry in the form of level sets. Instead, the files that are placed here are HDF5 representations of your embedded boundary graph, which can be <em>read</em> by PlasmaC if you enable <code class="docutils literal notranslate"><span class="pre">driver.read_ebis</span></code>. This is a shortcut that allows faster geometry generation when you restart simulations, but geometry generation is typically so fast that it is never used.</p>
<p>The reason for this structure is that PlasmaC can end up writing thousands of files per simulation and we feel that having a directory structure helps us navigate simulation data.</p>
<p>The driver class <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">driver</span></a> is responsible for writing output files at specified intervals, but the user is responsible for specifying what goes into those files. Since not all variables are always of interest, the solver classes themselves have options <code class="docutils literal notranslate"><span class="pre">plt_vars</span></code> that specify which output variables will be written to the output file. For example, our convection-diffusion-reaction solver classes have the following output options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cdr_gdnv.plt_vars <span class="o">=</span> phi vel dco src ebflux <span class="c1"># Plot variables. Options are &#39;phi&#39;, &#39;vel&#39;, &#39;dco&#39;, &#39;src&#39;, &#39;ebflux&#39;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">phi</span></code> is the state density, <code class="docutils literal notranslate"><span class="pre">vel</span></code> is the drift velocity, <code class="docutils literal notranslate"><span class="pre">dco</span></code> is the diffusion coefficient, <code class="docutils literal notranslate"><span class="pre">src</span></code> is the source term, and <code class="docutils literal notranslate"><span class="pre">ebflux</span></code> is the flux at embedded boundaries. Which variables are available for output changes for one class to the next. If you only want to plot the density, then you should put <code class="docutils literal notranslate"><span class="pre">cdr_gdnv.plt_vars</span> <span class="pre">=</span> <span class="pre">phi</span></code>. An empty entry like <code class="docutils literal notranslate"><span class="pre">cdr_gdnv.plt_vars</span> <span class="pre">=</span></code> will lead to run-time errors, so if you do not want a class to provide plot data you may put <code class="docutils literal notranslate"><span class="pre">cdr_gdnv.plt_vars</span> <span class="pre">=</span> <span class="pre">-1</span></code>.</p>
</div>
<div class="section" id="controlling-processor-output">
<h2>Controlling processor output<a class="headerlink" href="#controlling-processor-output" title="Permalink to this headline">¶</a></h2>
<p>By default, Chombo will write a process output file <em>per MPI process</em> and this file will be named <code class="file docutils literal notranslate"><span class="pre">pout.n</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the MPI rank. These files are written in the directory where you executed your application, and are <em>not</em> related to plot files or checkpoint files. However, PlasmaC prints information to these files as simulations advance (for example by displaying information of the current time step, or convergence rates for multigrid solvers). While it is possible to monitor the evolution of PlasmaC through each MPI, most of these files contain redundant information. To turn off the number of files that will be written, Chombo can read an environment variable <code class="docutils literal notranslate"><span class="pre">CH_OUTPUT_INTERVAL</span></code>. For example, if you only want the master MPI rank to write <code class="file docutils literal notranslate"><span class="pre">pout.0</span></code>, you would do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">CH_OUTPUT_INTERVAL</span><span class="o">=</span><span class="m">999999999</span>
</pre></div>
</div>
<p>You can, of course, put the definition in your <code class="file docutils literal notranslate"><span class="pre">.bashrc</span></code> file (for Bourne shell). Note that if you run simulations at high concurrencies, you <em>should</em> turn off the number of process output files since they impact the performance of the file system.</p>
</div>
<div class="section" id="restarting-simulations">
<span id="chap-restartingsimulations"></span><h2>Restarting simulations<a class="headerlink" href="#restarting-simulations" title="Permalink to this headline">¶</a></h2>
<p>Restarting simulations is done in exactly the same way as running simulations, although the user must set the <code class="docutils literal notranslate"><span class="pre">driver.restart</span></code> parameter. For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">32</span> &lt;application_executable&gt; &lt;input_file&gt; driver.restart<span class="o">=</span><span class="m">10</span>
</pre></div>
</div>
<p>will restart from step 10. If you set <code class="docutils literal notranslate"><span class="pre">driver.restart=0</span></code>, you will get a fresh simulation. Specifying anything but an integer is an error. When a simulation is restarted, PlasmaC will look for a checkpoint file with the <code class="docutils literal notranslate"><span class="pre">driver.output_names</span></code> variable and the specified restart step. If this file is not found, restarting will not work and <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code> will abort. You must therefore ensure that your executable can locate this file. This also implies that you cannot change the <code class="docutils literal notranslate"><span class="pre">driver.output_names</span></code> or <code class="docutils literal notranslate"><span class="pre">driver.output_directory</span></code> variables during restarts, unless you also change the name of your checkpoint file and move it to a new directory.</p>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p><cite>PlasmaC</cite> output files are written to HDF5 files in the format <code class="docutils literal notranslate"><span class="pre">&lt;simulation_name&gt;.step#.dimension.hdf5</span></code> and the files will be written to the directory specified by <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">driver</span></a> runtime parameters. Currently, we have only used VisIt for visualizing the plot files.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Visualization.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ParticleData.html" class="btn btn-neutral float-left" title="Understanding particle data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Robert Marskar

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>