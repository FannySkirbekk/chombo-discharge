

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>amr_mesh &mdash; PlasmaC 19.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="computational_geometry" href="ComputationalGeometry.html" />
    <link rel="prev" title="driver" href="Driver.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PlasmaC
          

          
          </a>

          
            
            
              <div class="version">
                19.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PlasmaC introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Model.html">The <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code> code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics.html">Chombo basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Using PlasmaC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Realm.html">Realm</a></li>
<li class="toctree-l1"><a class="reference internal" href="MeshData.html">Understanding mesh data</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParticleData.html">Understanding particle data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Control.html">Controlling <code class="docutils literal notranslate"><span class="pre">PlasmaC</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">PlasmaC design</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Driver.html">driver</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">amr_mesh</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-functionality">Main functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registering-operators">Registering operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-options">Class options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ComputationalGeometry.html">computational_geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeStepper.html">time_stepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="CellTagger.html">cell_tagger</a></li>
</ul>
<p class="caption"><span class="caption-text">Supported solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Solver.html">Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="CDR.html">Convection-Diffusion-Reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson.html">Poisson</a></li>
<li class="toctree-l1"><a class="reference internal" href="RTE.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sigma.html">Surface charge solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ito.html">Îto diffusion</a></li>
</ul>
<p class="caption"><span class="caption-text">Implemented models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="PoissonModel.html">Poisson model</a></li>
<li class="toctree-l1"><a class="reference internal" href="AdvectionDiffusionModel.html">Advection diffusion model</a></li>
<li class="toctree-l1"><a class="reference internal" href="BrownianWalkerModel.html">Brownian walker model</a></li>
<li class="toctree-l1"><a class="reference internal" href="MinimalPlasmaModel.html">Minimal plasma model</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html#setting-up-time-stepper">Setting up <code class="docutils literal notranslate"><span class="pre">time_stepper</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="References.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PlasmaC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>amr_mesh</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/AmrMesh.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="amr-mesh">
<span id="chap-amr-mesh"></span><h1>amr_mesh<a class="headerlink" href="#amr-mesh" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="#chap-amr-mesh"><span class="std std-ref">amr_mesh</span></a> handles (almost) all spatial operations in <cite>PlasmaC</cite>.
Internally, <a class="reference internal" href="#chap-amr-mesh"><span class="std std-ref">amr_mesh</span></a> contains a bunch of operators that are useful across classes, such as ghost cell interpolation operators, coarsening operators, and stencils for interpolation and extrapolation near the embedded boundaries. <a class="reference internal" href="#chap-amr-mesh"><span class="std std-ref">amr_mesh</span></a> also contains routines for generation and load-balancing of grids based and also contains simple routines for allocation and deallocation of memory.</p>
<p><a class="reference internal" href="#chap-amr-mesh"><span class="std std-ref">amr_mesh</span></a> is an integral part of <cite>PlasmaC</cite>, and users will never have the need to modify it unless they are implementing something entirely new. The behavior of <a class="reference internal" href="#chap-amr-mesh"><span class="std std-ref">amr_mesh</span></a> is modified through it’s available input parameters, listed below:</p>
<div class="section" id="main-functionality">
<h2>Main functionality<a class="headerlink" href="#main-functionality" title="Permalink to this headline">¶</a></h2>
<p>There are two main functionalities in <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code>:</p>
<ol class="arabic simple">
<li><p>Building grid hierarchies, and providing geometric information</p></li>
<li><p>Providing AMR operators.</p></li>
</ol>
<p>In practice, users will not interact directly with this functionality, it is called by <code class="docutils literal notranslate"><span class="pre">driver</span></code> at the appropriate stages of regrids.</p>
<p>The AMR operators are, for example, coarsening operators, interpolation operators, ghost cell interpolators etc.
To save some regrid time, we don’t always build every AMR operator that we might ever need, but have solvers <em>register</em> the ones that they specifically need.</p>
</div>
<div class="section" id="registering-operators">
<h2>Registering operators<a class="headerlink" href="#registering-operators" title="Permalink to this headline">¶</a></h2>
<p>To register an operator, one must call a public member function of <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">register_operator</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">a_operator</span><span class="p">,</span> <span class="k">const</span> <span class="n">phase</span><span class="o">::</span><span class="n">which_phase</span> <span class="n">a_phase</span><span class="p">);</span>
</pre></div>
</div>
<p>where the string identifier is the name of the operator and <code class="docutils literal notranslate"><span class="pre">a_phase</span></code> is the phase on which the operator will live.
Currently, the following operators are supported:</p>
<ol class="arabic simple">
<li><p><em>eb_gradient</em> for allocating stencils for computing the cell-centered gradient.</p></li>
<li><p><em>eb_irreg_interp</em> for allocating interpolation stencils in irregular cells, e.g. interpolation to centroids or boundary centroids.</p></li>
<li><p><em>eb_coar_ave</em> for conservative coarsening of data.</p></li>
<li><p><em>eb_quad_cfi</em> for quadratic filling of ghost cells.</p></li>
<li><p><em>eb_fill_patch</em> for linear interpolation of ghost cells.</p></li>
<li><p><em>eb_pwl_interp</em> for piecewise linear interpolation during e.g. regrids.</p></li>
<li><p><em>eb_flux_reg</em> for holding fluxes on refinement boundaries.</p></li>
<li><p><em>eb_redist</em> for holding redistribution objects (for e.g. particle deposition or divergence computatoins).</p></li>
<li><p><em>eb_copier</em> for adding the contents in ghost cells to the valid region on the same AMR level.</p></li>
<li><p><em>eb_ghostcloud</em> for adding the contents in ghost cells on the refinement boundary to the coarser AMR level.</p></li>
<li><p><em>eb_non_cons_div</em> for computing stencils for doing the non-conservative divergence.</p></li>
</ol>
</div>
<div class="section" id="class-options">
<h2>Class options<a class="headerlink" href="#class-options" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================================================================================</span>
<span class="c1"># AMR_MESH OPTIONS</span>
<span class="c1"># ====================================================================================================</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">lo_corner</span>       <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Low corner of problem domain</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">hi_corner</span>       <span class="o">=</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">1</span>    <span class="c1"># High corner of problem domain</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">verbosity</span>       <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>          <span class="c1"># Controls verbosity. </span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">coarsest_domain</span> <span class="o">=</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span> <span class="c1"># Number of cells on coarsest domain</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">max_amr_depth</span>   <span class="o">=</span> <span class="mi">0</span>           <span class="c1"># Maximum amr depth</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">max_sim_depth</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>          <span class="c1"># Maximum simulation depth</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">refine_all_lvl</span>  <span class="o">=</span> <span class="mi">0</span>           <span class="c1"># Refine everything down to this level.</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">fill_ratio</span>      <span class="o">=</span> <span class="mf">1.0</span>         <span class="c1"># Fill ratio for grid generation</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">irreg_growth</span>    <span class="o">=</span> <span class="mi">2</span>           <span class="c1"># How much to grow irregular tagged cells</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">buffer_size</span>     <span class="o">=</span> <span class="mi">2</span>           <span class="c1"># Number of cells between grid levels</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">grid_algorithm</span>  <span class="o">=</span> <span class="n">br</span>          <span class="c1"># Berger-Rigoustous &#39;br&#39; or &#39;tiled&#39; for the tiled algorithm</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="mi">16</span>          <span class="c1"># Default blocking factor (16 in 3D)</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">max_box_size</span>    <span class="o">=</span> <span class="mi">16</span>          <span class="c1"># Maximum allowed box size</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">max_ebis_box</span>    <span class="o">=</span> <span class="mi">16</span>          <span class="c1"># Maximum allowed box size</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">ref_rat</span>         <span class="o">=</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="c1"># Refinement ratios</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">num_ghost</span>       <span class="o">=</span> <span class="mi">3</span>           <span class="c1"># Number of ghost cells. Default is 3</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">eb_ghost</span>        <span class="o">=</span> <span class="mi">4</span>           <span class="c1"># Set number of of ghost cells for EB stuff</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">centroid_sten</span>   <span class="o">=</span> <span class="n">linear</span>      <span class="c1"># Centroid interp stencils. &#39;pwl&#39;, &#39;linear&#39;, &#39;taylor, &#39;lsq&#39;</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">eb_sten</span>         <span class="o">=</span> <span class="n">pwl</span>         <span class="c1"># EB interp stencils. &#39;pwl&#39;, &#39;linear&#39;, &#39;taylor, &#39;lsq&#39;</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">redist_radius</span>   <span class="o">=</span> <span class="mi">1</span>           <span class="c1"># Redistribution radius for hyperbolic conservation laws</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">ghost_interp</span>    <span class="o">=</span> <span class="n">pwl</span>         <span class="c1"># Ghost cell interpolation type. Valid options are &#39;pwl&#39; or &#39;quad&#39;</span>
<span class="n">amr_mesh</span><span class="o">.</span><span class="n">ebcf</span>            <span class="o">=</span> <span class="n">true</span>        <span class="c1"># If you have EBCF crossing, this must be true. </span>
</pre></div>
</div>
<p>We now discuss the various <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code> class options.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.verbosity</span></code> controls the verbosity of this class. <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code> can potentially do a lot of output, so it is best to leave this to the default value (-1) unless you are debugging.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.coarsest_domain</span></code> is the partitioning of the <em>coarsest</em> grid level that discretizes your problem domain. The entries in this option must all be integers of <code class="docutils literal notranslate"><span class="pre">amr_mesh.max_box_size</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.blocking_factor</span></code> sets the minimum box size that can be generated by the mesh generation algorithm. We remark that if you are doing particle deposition, <code class="docutils literal notranslate"><span class="pre">amr_mesh.blocking_factor</span></code> and <code class="docutils literal notranslate"><span class="pre">amr_mesh.max_box_size</span></code> MUST be equal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.max_box_size</span></code> sets the maximum box size that can be generated by the mesh generation algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.max_ebis_box</span></code> sets the maximum box size that will be used in the geometry generation step. A smaller box will consume less memory, but geometry generation runtime will be longer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.max_amr_depth</span></code> defines the largest possible number of grids that can be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.max_sim_depth</span></code> defines the maximum simulation depth for the simulation. This options exists because you may want to run one part of a simulation using a coarser resolution than <code class="docutils literal notranslate"><span class="pre">amr_mesh.max_amr_depth</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.refine_all_lvl</span></code> is deprecated class option.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.mg_coarsen</span></code> is a “pre-coarsening” method for multigrid solvers. The deeper multigrids levels are there to facilitate convergence, and it often helps to use fairly large box sizes on some of these levels before aggregating boxes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.fill_ratio</span></code> is the fill ratio for the mesh refinement algorithm. This value must be between 0 and 1; a smaller value will result in larger grids. A higher value results in more compact grids, but possibly with more boxes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.irreg_growth</span></code> controls how much irregular tags (e.g. boundary tags) are grown before being passed into the mesh refinement algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.buffer_size</span></code> is the minimum number of cells between grid levels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.ref_rat</span></code> is the refinement factor between levels. Values 2 and 4 are supported, and you may use mixed refinement ratios. The length of this vector must be at least equal to the number of refinement levels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.num_ghost</span></code> indicates how many ghost cells to use for all data holders. The typical value is 3 for EB-applications, but non-EB applications might get away with fewer ghost cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.eb_ghost</span></code> controls how ghost cells are used for the EB generation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.centroid_sten</span></code> controls which stencil is used for interpolating data to irregular cell centroids. Currently available options are ‘pwl’ (piecewise linear), ‘linear’ (bi/trilinear), ‘taylor’ (higher order Taylor expansion), and ‘lsq’ which is a least squares fit. Only ‘pwl’ is guaranteed to have positive weights in the stencil.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.eb_sten</span></code> controls which stencil is used for interpolation/extrapolation to embedded boundary centroids. We cannot guarantee that the stencils have only positive weights.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.redist_radius</span></code> is the redistribution radius for hyperbolic redistribution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.ghost_interp</span></code> defines the ghost cell interpolation type. Algorithms that require very specific ghost cell interpolation schemes (advection, for example) use their own interpolation method that is outside user control. The available options are ‘pwl’ (piecewise linear) and ‘quad’ (quadratic).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.load_balance</span></code> tells <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code> how to load balance the grids.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amr_mesh.ebcf</span></code> allows <code class="docutils literal notranslate"><span class="pre">amr_mesh</span></code> to turn on certain optimizations when there are <strong>not</strong> crossing between embedded boundaries and grid refinement boundaries. If such crossings exist, and you set this flag to false, <cite>PlasmaC</cite> <em>will</em> compute incorrect answers.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ComputationalGeometry.html" class="btn btn-neutral float-right" title="computational_geometry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Driver.html" class="btn btn-neutral float-left" title="driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Robert Marskar

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>